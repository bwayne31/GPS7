<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Golf GPS</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
/* Fade transition */
.fade-enter {
    opacity: 0;
    transition: opacity 0.4s ease;
}
.fade-enter-active {
    opacity: 1;
}
/* GPS accuracy warning banner */
.gps-warning {
    @apply fixed top-0 left-0 w-full text-center text-white py-1 bg-red-600 text-sm hidden;
}
</style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100">

<!-- GPS Accuracy Warning -->
<div id="gpsWarning" class="gps-warning">GPS accuracy is low. Distances may be off.</div>

<!-- Hole Info -->
<div id="holeInfo" class="p-4 fade-enter-active">
    <h1 class="text-2xl font-bold mb-2">Hole 1</h1>
    <div id="distances" class="mb-4"></div>
    <div id="hazards"></div>
</div>

<script>
// Sample course data (same style as before)
const courseData = [
    {
        hole: 1,
        tee: { lat: 40.7128, lng: -74.0060 },
        green: { lat: 40.7135, lng: -74.0055 },
        hazards: [
            { type: "Bunker", location: { lat: 40.7130, lng: -74.0058 } },
            { type: "Water", front: { lat: 40.7132, lng: -74.0057 }, back: { lat: 40.7133, lng: -74.0056 } }
        ]
    }
    // ... more holes
];

let currentHole = 0;

// Haversine formula for distances in yards
function getDistance(lat1, lon1, lat2, lon2) {
    const R = 6371000;
    const toRad = x => x * Math.PI / 180;
    const dLat = toRad(lat2 - lat1);
    const dLon = toRad(lon2 - lon1);
    const a = Math.sin(dLat/2) ** 2 +
              Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
              Math.sin(dLon/2) ** 2;
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    return (R * c) * 1.09361; // meters to yards
}

function displayDistances(position) {
    const hole = courseData[currentHole];
    const { latitude, longitude, accuracy } = position.coords;

    // GPS accuracy warning
    const warning = document.getElementById('gpsWarning');
    if (accuracy > 15) {
        warning.classList.remove('hidden');
    } else {
        warning.classList.add('hidden');
    }

    // Fade transition
    const container = document.getElementById('holeInfo');
    container.classList.add('fade-enter');
    setTimeout(() => container.classList.remove('fade-enter'), 10);

    // Hole title
    container.querySelector('h1').textContent = `Hole ${hole.hole}`;

    // Distances
    const distancesDiv = document.getElementById('distances');
    const toGreen = Math.round(getDistance(latitude, longitude, hole.green.lat, hole.green.lng));
    distancesDiv.innerHTML = `<div class="mb-2 text-lg font-semibold">To Green: ${toGreen} yds</div>`;

    // Hazards
    const hazardsDiv = document.getElementById('hazards');
    hazardsDiv.innerHTML = '';
    hole.hazards.forEach(h => {
        let html = '';
        if (h.location) {
            const dist = Math.round(getDistance(latitude, longitude, h.location.lat, h.location.lng));
            html = `<div class="hazard-card bg-yellow-200 flex justify-between items-center my-2 py-2 px-3 rounded-xl shadow-sm">
                        <span>${h.type}</span>
                        <span>${dist} yds</span>
                    </div>`;
        } else if (h.front && h.back) {
            const frontDist = Math.round(getDistance(latitude, longitude, h.front.lat, h.front.lng));
            const backDist = Math.round(getDistance(latitude, longitude, h.back.lat, h.back.lng));
            html = `<div class="hazard-card bg-blue-200 flex justify-between items-center my-2 py-2 px-3 rounded-xl shadow-sm">
                        <span>${h.type} (Front)</span>
                        <span>${frontDist} yds</span>
                    </div>
                    <div class="hazard-card bg-blue-300 flex justify-between items-center my-2 py-2 px-3 rounded-xl shadow-sm">
                        <span>${h.type} (Back)</span>
                        <span>${backDist} yds</span>
                    </div>`;
        }
        hazardsDiv.innerHTML += html;
    });
}

// Handle GPS errors
function handleGPSError(error) {
    alert(`GPS Error: ${error.message}`);
}

// Watch position, but only update if speed is low
navigator.geolocation.watchPosition((position) => {
    const speed = position.coords.speed || 0; // m/s
    if (speed < 0.5) { // ~1.1 mph
        displayDistances(position);
    }
}, handleGPSError, { enableHighAccuracy: true, maximumAge: 1000, timeout: 5000 });

</script>
</body>
</html>
